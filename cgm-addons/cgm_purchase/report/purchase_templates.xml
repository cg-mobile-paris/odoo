<?xml version="1.0" encoding="UTF-8" ?>

<odoo>
    <template id="report_state_of_needs_document" inherit_id="purchase.report_purchasequotation_document" primary="True" priority="1000">
        <xpath expr="//span[@t-field='o.name']//.." position="replace">
            <table class="w-100">
                <tr>
                    <td class="text-left"><h2 class="p-2">State of Needs <span t-field="o.name"/></h2></td>
                    <td class="text-right"><img class="p-2 d-block" t-if="o.licence_id" t-att-src="image_data_uri(o.licence_id.image_128)" alt="Licence"/></td>
                </tr>
            </table>
        </xpath>

        <!-- th -->
        <xpath expr="//th[@name='th_expected_date']" position="replace">
        </xpath>

        <xpath expr="//th[@name='th_quantity']//strong" position="replace">
            <strong>Qty Available</strong>
        </xpath>

        <xpath expr="//th[@name='th_quantity']" position="before">
            <th><strong>EAN Code</strong></th>
            <th><strong>FOB HK</strong></th>
        </xpath>

        <xpath expr="//th[@name='th_quantity']" position="after">
            <th><strong>Qty Expected</strong></th>
            <th><strong>Qty Projected</strong></th>
            <th><strong>Qty Ordered</strong></th>
        </xpath>

        <!-- td -->
        <xpath expr="//span[@t-field='order_line.date_planned']//.." position="replace">
        </xpath>

        <xpath expr="//span[@t-field='order_line.product_qty']" position="attributes">
            <attribute name="t-field">order_line.qty_available</attribute>
        </xpath>

        <xpath expr="//span[@t-field='order_line.qty_available']//.." position="before">
            <td><span t-field="order_line.product_id.barcode"/></td>
            <td><span t-field="order_line.price_unit"/></td>
        </xpath>

        <xpath expr="//span[@t-field='order_line.qty_available']//.." position="after">
            <td><span t-field="order_line.qty_expected"/></td>
            <td><span t-field="order_line.virtual_available"/></td>
            <td><span t-field="order_line.product_qty"/></td>
        </xpath>
    </template>

    <template id="report_state_of_needs">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="cgm_purchase.report_state_of_needs_document" t-lang="o.partner_id.lang"/>
            </t>
        </t>
    </template>
</odoo>